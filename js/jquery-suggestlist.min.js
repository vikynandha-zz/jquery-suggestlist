(function(e){function t(t,r){var i=this;this.element=e(t).attr("autocomplete","off").addClass("suggestlist-input");this.options=e.extend(e.fn.suggestlist.defaults,r);this.picker=n.render(r).on("click.suggestlist","li",e.proxy(this.clickLi,this));this.isInput=this.element.is("input");this.destroy=function(){i.hide();i.picker.remove();i.element.off(".suggestlist").removeData("suggestlist")};this.picker.width(this.element.outerWidth());e(document).on("mousedown.suggestlist",function(t){if(e(t.target).closest(".suggestlist, .suggestlist-input").length==0){i.hide()}});if(this.isInput){this.element.on({"focus.suggestlist":e.proxy(this.show,this),"click.suggestlist":e.proxy(this.click,this),"keydown.suggestlist":e.proxy(this.keydown,this),"keyup.suggestlist":e.proxy(this.updateLi,this)});this.element.parent().on({reset:e.proxy(this.resetDefault,this)});this.updateLi()}}function r(t){if(!t)return;return parseInt(t.parents().filter(function(){return e(this).css("z-index")!=="auto"}).first().css("z-index"),10)}t.prototype={constructor:t,click:function(){if(this.picker.is(":hidden")){this.show()}},clickLi:function(t){this.picker.find("li.suggestlist-selected").removeClass("suggestlist-selected");e(t.currentTarget).addClass("suggestlist-selected");this.element[0].focus();this.updateVal()},keydown:function(e){switch(e.keyCode){case 27:this.hide();e.preventDefault();break;case 9:this.hide();break;case 38:if(this.picker.is(":not(:visible)")){this.show();return}this.selectPrev();break;case 40:if(this.picker.is(":not(:visible)")){this.show();return}this.selectNext();break;case 13:if(this.picker.is(":visible")){this.updateVal();e.preventDefault()}break}},show:function(t){this.picker.show();this.place();e(window).on("resize.suggestlist",e.proxy(this.place,this));if(t){t.stopPropagation();t.preventDefault()}},hide:function(t){this.picker.hide();e(window).off("resize",e.proxy(this.place,this))},place:function(){var e=this.element.offset();this.picker.css({left:e.left,top:e.top+this.element.outerHeight()})},selectNext:function(){var e,t;e=this.picker.find("li.suggestlist-selected").first();if(e.length===0){t=this.picker.find("li").first()}else{if(e.is(":last-child")){return}t=e.removeClass("suggestlist-selected").next()}t.addClass("suggestlist-selected")},selectPrev:function(){var e,t;e=this.picker.find("li.suggestlist-selected").first();if(e.length===0){t=this.picker.find("li").last()}else{if(e.is(":first-child")){return}t=e.removeClass("suggestlist-selected").prev()}t.addClass("suggestlist-selected")},updateVal:function(){this.element.val(this.picker.find("li.suggestlist-selected").text());this.hide()},updateLi:function(t){if(t){var n=String.fromCharCode(t.keyCode).toLowerCase();if(t.ctrlKey||!/^[0-9a-z ]$/.test(n)){return}}var r=e.trim(this.element.val()).replace(/\s+/," "),i=this.picker.find("li"),s=i.filter(".suggestlist-selected").first();if(r===s.text()){return}if(e.inArray(r,this.options.list)===-1){return false}s.removeClass("suggestlist-selected");this.picker.find("li").each(function(t,n){if(e(n).text()===r){e(n).addClass("suggestlist-selected")}});if(t){this.show()}},resetDefault:function(t){that=this;this.picker.find("li.suggestlist-selected").removeClass("suggestlist-selected");this.picker.find("li").filter(function(){return e(this).text()==that.element.attr("value")}).first().addClass("suggestlist-selected");this.element[0].focus();this.updateVal()}};var n={render:function(t){var n=e("<ul/>"),i;n.addClass("suggestlist").css({zIndex:r(this.element)});for(i=0;i<t.list.length;i++){n.append("<li>"+t.list[i]+"</li>");if(i===0){n.addClass("suggestlist-selected")}}n.appendTo("body");return n}};e.fn.suggestlist=function(n){var r=Array.apply(null,arguments);r.shift();return this.each(function(){var i=e(this),s=i.data("suggestlist"),o=typeof n=="object"&&n;if(!s){s=new t(this,e.extend({},e.fn.suggestlist.defaults,o));i.data("suggestlist",s)}if(typeof n=="string"&&typeof s[n]=="function"){s[n].apply(s,r)}})};e.fn.suggestlist.defaults={list:[]}})(jQuery)